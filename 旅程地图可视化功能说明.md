# 旅程地图可视化功能说明

## 功能概述

为了让用户在地图上清楚地区分同一旅程中的地点，我们实现了以下视觉区分方案：

## 主要特性

### 1. 🎨 旅程专属颜色系统

- **自动颜色分配**：每个旅程会自动获得一个专属颜色
- **颜色池**：包含10种精心挑选的颜色（蓝、绿、橙、紫、粉、青、薄荷、靛蓝、青绿、棕）
- **智能标记**：属于同一旅程的所有地点都使用该旅程的专属颜色
- **兼容性**：没有分配到旅程的地点仍然使用原有的国内/国外颜色区分（红/蓝）

### 2. 🔗 旅程路线连接

- **按时间连线**：同一旅程中的地点会按访问日期顺序用线连接
- **视觉效果**：连线使用该旅程的专属颜色，60%透明度，2点线宽
- **一键切换**：地图右上角新增连线切换按钮，可随时开启/关闭连线显示
- **智能显示**：只有包含2个或以上地点的旅程才会显示连线

### 3. 💍 双层边框标识

- **外圈光环**：属于旅程的地点标记外围会显示一个半透明的彩色圆环
- **视觉层次**：
  - 外圈：旅程颜色，60%透明度，3点线宽
  - 主体：标记本身，使用旅程颜色填充
  - 内圈：白色边框，2点线宽
- **大小适配**：外圈直径比主标记大8点，确保清晰可见

### 4. 🏷️ 旅程图标显示

- **标记内容**：
  - 收藏地点：显示黄色星标（优先级最高）
  - 旅程地点：显示白色地图图钉图标
  - 聚合标记：显示地点数量
- **信息卡片**：点击地点时，预览卡片中会显示该地点所属的旅程名称

### 5. 🎯 聚合智能识别

- **共同旅程检测**：当多个地点聚合时，系统会自动识别最常见的旅程
- **颜色继承**：聚合标记使用最常出现旅程的颜色
- **后备方案**：如果聚合中的地点来自不同旅程，则使用国内/国外混合颜色逻辑

## 使用方法

### 查看旅程连线

1. 打开地图视图
2. 点击右上角的连线图标按钮（波浪线图标）
3. 蓝色高亮状态表示连线已开启，灰色表示已关闭

### 识别同一旅程的地点

通过以下视觉线索快速识别：

1. **颜色相同**：同一旅程的所有地点颜色一致
2. **连线相连**：开启连线后，地点之间有彩色路径相连
3. **外圈光环**：所有旅程地点都有特殊的外圈标识
4. **旅程图标**：标记内显示地图图钉图标

### 地点详情

点击任何地点标记后：
- 底部会弹出预览卡片
- 卡片中显示地点名称、所属旅程（如有）、国家和访问日期
- 点击右侧箭头可查看完整详情

## 颜色方案

### 旅程颜色（按顺序分配）
1. 蓝色 (Blue) - 第1个旅程
2. 绿色 (Green) - 第2个旅程
3. 橙色 (Orange) - 第3个旅程
4. 紫色 (Purple) - 第4个旅程
5. 粉色 (Pink) - 第5个旅程
6. 青色 (Cyan) - 第6个旅程
7. 薄荷色 (Mint) - 第7个旅程
8. 靛蓝色 (Indigo) - 第8个旅程
9. 青绿色 (Teal) - 第9个旅程
10. 棕色 (Brown) - 第10个旅程

超过10个旅程时，颜色会循环使用。

### 无旅程地点颜色
- 红色：国内地点
- 蓝色：国外地点

## 技术细节

### 标记尺寸

**单个地点标记**（根据缩放级别）：
- 街道级别（>12）：44点
- 城市级别（>10）：40点
- 市级别（>8）：36点
- 其他级别：32点

**聚合标记**（根据地点数量）：
- < 5个地点：32点
- 5-9个地点：36点
- 10-19个地点：40点
- ≥ 20个地点：44点

### 连线规则

- 最少2个地点才会显示连线
- 按 `visitDate` 排序连接
- 线条宽度：2点
- 透明度：60%

### 地图控制按钮

地图右上角从上到下：
1. **添加地点**（蓝色大按钮）：添加新的旅行地点
2. **切换连线**（蓝色/灰色）：开启/关闭旅程连线显示
3. **重置视图**（灰色）：重置地图视角，显示所有地点

## 最佳实践

### 1. 创建旅程时
- 为旅程起一个简短且有意义的名称
- 设置准确的开始和结束日期
- 添加地点时确保访问日期正确，这样连线顺序才正确

### 2. 查看地图时
- 放大到适当级别以避免过多聚合
- 使用连线功能查看旅程路线
- 点击地点查看详细信息和所属旅程

### 3. 规划新旅程
- 先创建旅程，再添加地点
- 利用不同颜色快速识别不同旅程
- 通过连线检查旅程路线是否合理

## 视觉示例

```
无旅程地点：    ⭕ (红色/蓝色)
旅程地点：      ⊙⭕ (彩色外圈 + 彩色标记 + 图标)
聚合标记：      ⭕5 (颜色基于主要旅程)
旅程连线：      ○---○---○ (彩色虚线连接)
```

## 注意事项

1. **颜色循环**：如果创建超过10个旅程，颜色会重复使用
2. **聚合显示**：在较小缩放级别时，多个地点会聚合成一个标记
3. **性能优化**：连线只在需要时绘制，不影响地图性能
4. **兼容性**：新功能完全兼容现有的国内/国外分类系统

## 更新日期

2025年10月19日

