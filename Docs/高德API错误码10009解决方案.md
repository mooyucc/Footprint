# 高德API错误码10009解决方案

## ❌ 错误信息

```
[高德API] API返回错误: USERKEY_PLAT_NOMATCH (code: 10009)
```

## 🔍 错误含义

**USERKEY_PLAT_NOMATCH** = **USER KEY PLATFORM NO MATCH**

表示：**API Key 的平台类型与调用接口不匹配**

## 📋 问题分析

### 当前情况

你的代码使用的是 **Web服务API**（RESTful API）：
```
https://restapi.amap.com/v3/geocode/regeo
```

### 可能的原因

1. **Key类型不匹配**
   - 申请的Key可能是 **iOS平台Key**
   - 但代码调用的是 **Web服务API**
   - 两者不兼容

2. **Key绑定平台错误**
   - 在申请Key时，选择的平台类型不正确
   - 需要选择 **"Web服务"** 平台

## ✅ 解决方案

### 方案1：申请Web服务类型的Key（推荐）

#### 步骤：

1. **登录高德开放平台**
   - 访问：https://console.amap.com/
   - 使用你的账号登录

2. **进入"应用管理"**
   - 点击左侧菜单 "应用管理" → "我的应用"

3. **创建新应用或修改现有应用**
   - 如果是新应用：点击"创建新应用"
   - 如果已有应用：点击应用名称进入详情

4. **添加Key时选择正确的平台**
   - 点击"添加"按钮
   - **关键步骤**：在"服务平台"中选择：
     - ✅ **"Web服务"** （不是"iOS平台"）
   - 填写应用名称和其他信息
   - 提交

5. **获取新的Key**
   - 复制新创建的Key
   - 更新到 `Info.plist` 中的 `AMapAPIKey`

### 方案2：检查现有Key的平台类型

#### 步骤：

1. **登录高德开放平台**
   - 访问：https://console.amap.com/

2. **查看应用详情**
   - 进入 "应用管理" → "我的应用"
   - 点击你的应用名称

3. **检查Key的平台类型**
   - 查看每个Key的"服务平台"列
   - 如果显示的是 **"iOS平台"** → 需要添加 **"Web服务"** 类型的Key
   - 如果显示的是 **"Web服务"** → 检查是否有其他问题

## 📝 平台类型说明

### Web服务Key
- ✅ 用于RESTful API调用（HTTP请求）
- ✅ 适用于：Web服务、后端服务、移动应用（通过HTTP调用）
- ✅ 当前代码需要的类型

### iOS平台Key
- ✅ 用于高德iOS SDK
- ❌ 不能用于RESTful API调用
- 如果使用SDK，需要用这个类型

### Android平台Key
- ✅ 用于高德Android SDK
- ❌ 不能用于RESTful API调用

## 🔧 当前代码使用的接口

```swift
// 这是Web服务API，需要Web服务类型的Key
let urlString = "https://restapi.amap.com/v3/geocode/regeo"
```

**结论**：必须使用 **"Web服务"** 类型的Key

## ⚠️ 注意事项

1. **一个应用可以有多个Key**
   - 可以为同一应用创建多个Key
   - 每个Key可以绑定不同的平台类型

2. **Key安全性**
   - ⚠️ 不要将Key提交到Git仓库
   - ⚠️ 建议使用环境变量或配置文件（不纳入版本控制）

3. **配额限制**
   - Web服务Key通常有每日配额限制
   - 个人开发者配额一般足够日常使用
   - 如需更高配额，可在控制台申请

## 📊 检查清单

- [ ] 登录高德开放平台
- [ ] 检查现有Key的平台类型
- [ ] 如果类型不对，申请新的Web服务类型Key
- [ ] 更新 `Info.plist` 中的 `AMapAPIKey`
- [ ] 重新测试API调用

## 🎯 快速验证

申请到正确的Key后，可以测试：

```bash
# 测试API调用（将YOUR_KEY替换为新的Key）
curl "https://restapi.amap.com/v3/geocode/regeo?key=YOUR_KEY&location=116.397128,39.916527"
```

如果返回正常的地理编码结果（JSON格式），说明Key类型正确。

如果仍然返回错误码10009，可能是：
- Key没有正确复制（包含空格）
- Key被禁用或过期
- 需要等待几分钟让Key生效

---

**最后更新**：2025-12-05

