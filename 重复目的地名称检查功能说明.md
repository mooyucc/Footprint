# 重复目的地名称检查功能说明

## 功能概述

在添加目的地时，如果输入的地点名称与现有目的地名称一致，系统会提示用户是否覆盖原有目的地。原则上不允许出现同名的目的地。

## 实现细节

### 1. 检查逻辑
- 在 `AddDestinationView.swift` 的 `saveDestination()` 方法中添加了重复名称检查
- 使用不区分大小写的比较，并去除首尾空格
- 检查所有现有目的地，查找是否有相同名称

### 2. 用户界面
- 当发现重复名称时，显示确认对话框
- 对话框包含：
  - 重复名称的提示信息
  - 现有目的地的详细信息（国家、访问日期、备注）
  - "覆盖"和"取消"两个选项
  - 说明文字："原则上不允许出现同名的目的地"

### 3. 覆盖功能
- 如果用户选择"覆盖"，会更新现有目的地的所有信息
- 包括：名称、国家、坐标、访问日期、备注、照片、分类、喜爱状态、旅程关联
- 如果用户选择"取消"，则不进行任何操作

### 4. 本地化支持
- 添加了中英文本地化字符串支持
- 中文：`zh-Hans.lproj/Localizable.strings`
- 英文：`en.lproj/Localizable.strings`

## 新增的本地化字符串

### 中文
```
"duplicate_destination_title" = "重复的目的地";
"duplicate_destination_message" = "已存在名为「%@」的目的地，是否要覆盖原有目的地？\n\n现有目的地信息：\n国家：%@\n访问日期：%@%@\n\n原则上不允许出现同名的目的地";
"duplicate_destination_overwrite" = "覆盖";
"duplicate_destination_cancel" = "取消";
```

### 英文
```
"duplicate_destination_title" = "Duplicate Destination";
"duplicate_destination_message" = "A destination named '%@' already exists. Do you want to overwrite the existing destination?\n\nExisting destination info:\nCountry: %@\nVisit Date: %@%@\n\nDuplicate destination names are not allowed in principle";
"duplicate_destination_overwrite" = "Overwrite";
"duplicate_destination_cancel" = "Cancel";
```

## 修复说明

### 问题
初始实现中，警告对话框显示的是本地化键名（如 `duplicate_destination_title`）而不是实际的翻译文本。

### 根本原因
这个应用使用的是自定义的本地化系统（LanguageManager），而不是系统的NSLocalizedString。我们之前添加的Localizable.strings文件没有被使用。

### 解决方案
1. **发现自定义本地化系统**：应用使用LanguageManager.swift中的自定义本地化字典
2. **添加字符串到正确位置**：在LanguageManager的localizedStrings字典中添加重复目的地检查的字符串
3. **支持中英文**：在中文字典（"zh-Hans"）和英文字典（"en"）中都添加了相应的字符串
4. **简化Alert实现**：使用计算属性alertMessage来生成消息文本

### 技术细节
- 应用使用LanguageManager.shared.localizedString(for: key)方法
- 字符串存储在localizedStrings字典中，按语言分组
- 使用 `String.localized(with: arguments...)` 方法传递多个参数
- 在SwiftUI的alert message中直接使用Text组件，避免复杂的布局
- 支持动态显示备注信息（如果有的话）

## 代码修改

### AddDestinationView.swift
1. 添加了状态变量：
   - `@State private var showDuplicateAlert = false`
   - `@State private var duplicateDestinationName = ""`
   - `@State private var existingDestination: TravelDestination?`

2. 添加了查询：
   - `@Query private var allDestinations: [TravelDestination]`

3. 修改了 `saveDestination()` 方法，添加重复检查逻辑

4. 新增了 `createAndSaveDestination()` 和 `overwriteExistingDestination()` 方法

5. 添加了确认对话框的UI

6. 添加了 `alertMessage` 计算属性来生成格式化消息

### LanguageManager.swift
1. 在中文字符串字典（"zh-Hans"）中添加了：
   - `"duplicate_destination_title": "重复的目的地"`
   - `"duplicate_destination_message": "已存在名为「%@」的目的地，是否要覆盖原有目的地？\n\n现有目的地信息：\n国家：%@\n访问日期：%@%@\n\n原则上不允许出现同名的目的地"`
   - `"duplicate_destination_overwrite": "覆盖"`
   - `"duplicate_destination_cancel": "取消"`

2. 在英文字符串字典（"en"）中添加了：
   - `"duplicate_destination_title": "Duplicate Destination"`
   - `"duplicate_destination_message": "A destination named '%@' already exists. Do you want to overwrite the existing destination?\n\nExisting destination info:\nCountry: %@\nVisit Date: %@%@\n\nDuplicate destination names are not allowed in principle"`
   - `"duplicate_destination_overwrite": "Overwrite"`
   - `"duplicate_destination_cancel": "Cancel"`

## 测试建议

1. 创建一个目的地，名称为"北京"
2. 再次尝试创建名为"北京"的目的地
3. 应该会弹出重复名称确认对话框
4. 测试"覆盖"和"取消"两个选项的功能

## 注意事项

- 名称比较不区分大小写
- 会自动去除首尾空格
- 覆盖操作会更新现有目的地的所有信息
- 支持中英文界面
- 编译成功，无错误，只有一些关于iOS 26.0弃用API的警告
